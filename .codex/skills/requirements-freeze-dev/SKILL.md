---
name: requirements-freeze-dev
description: 将“一句话需求”转成可执行开发任务：先多轮澄清直到无歧义，再产出并冻结开发文档，最后严格按冻结文档实施开发与测试。用于需求模糊、变更频繁、需要控制范围或降低返工风险的编码任务。
---

# Requirements Freeze Dev

按顺序执行：先澄清，再冻结，再开发。每个阶段输出简短进度。

## 0) 初始化工作区（先清理，再思考）

- 在开始需求分析前，先清理 `doc/` 与 `logs/` 目录内容，避免历史文档和旧日志污染本轮判断。
- 仅清理目录内容，不删除目录本身。
- 若目录不存在，记录并跳过。
- 清理完成后，先输出“初始化完成”，再进入澄清阶段。

## 1) 澄清需求（多轮追问）

- 接到一句话需求后，先复述当前理解，再提出最关键的 1-3 个问题。
- 每轮优先消除以下歧义：目标行为、输入输出、边界/异常、非功能要求、验收标准、范围外事项。
- 若信息不足以编码，继续追问，不要直接进入实现。
- 使用“已确认 / 待确认 / 假设”三栏维护状态，避免遗漏。

## 2) 达成“可冻结”条件

在进入冻结前，逐项检查以下条件全部满足：

- 目标与范围明确，且有明确的 out-of-scope。
- 接口或命令契约可执行（参数、格式、默认值、错误处理）。
- 数据影响、兼容性和迁移策略已确认（如适用）。
- 测试与验收标准可验证（至少包含正向、边界、失败场景）。
- 未决问题为 0；若仍有假设，必须经用户显式确认。

## 3) 产出冻结开发文档

- 基于 `references/frozen-dev-spec-template.md` 生成冻结文档。
- 文档默认路径：`doc/frozen/`；文件名：`{yyyyMMddHHmm}-{task-slug}-frozen-spec.md`。
- 文档必须包含：背景、目标、范围、契约、方案、测试计划、风险、验收标准、变更控制。
- 将所有关键决策写成“可追踪条目”（决策 + 理由 + 影响）。

## 4) 冻结前核对确认（必须）

- 将冻结文档全文或关键摘要发给用户，并明确询问“文档是否无误”。
- 若用户指出问题，先更新文档并回到本步骤再次确认。
- 在用户明确回复“无误/确认”前，不要冻结文档，也不要实施代码改动。

## 5) 请求冻结确认

- 在文档被确认“无误”后，再次询问“是否冻结并进入开发”。
- 用户未明确确认冻结前，不要开始编码。
- 用户确认后，记录冻结版本与时间戳，作为开发基线。

## 6) 按冻结文档实施开发

- 按小步修改实施，每一步保持可运行、可验证。
- 同步更新或新增单元测试；优先修复已发现缺陷，再扩展功能。
- 若实现中发现与冻结文档冲突，暂停编码并走变更流程。

## 7) 变更控制（冻结后）

- 任何新增需求或范围变更，都先更新冻结文档再改代码。
- 在文档中追加“变更记录”：变更原因、影响评估、测试影响、批准人。
- 仅在用户确认新版本冻结后继续实现。

## 8) 输出结果

- 先给出实现结果与验收结论，再附测试结果与剩余风险。
- 明确说明本次实现对应的冻结文档路径与版本号。
